<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Test case generation</title>
  <script>
    function submitForm() {
      var selectedItems = [];
      var checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      for (let i = 0; i < checkboxes.length; i++) {
        selectedItems.push(checkboxes[i].id);
      }
      var request = new XMLHttpRequest();
      request.open('POST', 'http://127.0.0.1:5000/submit');
      request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      request.onreadystatechange = function () {
        if ((request.readyState === 4) && (request.status === 200)) {
          const responseText = request.responseText;
          const jsonResponse = JSON.parse(responseText);
          alert(jsonResponse);
          document.body.innerHTML += JSON.stringify(jsonResponse);
        }
      };
      request.send('selectedItems=' + encodeURIComponent(JSON.stringify(selectedItems)));
    }
    function insert_spec(node, specification, incr) {
      const h1 = document.createElement('h1');
      h1.textContent = specification['title'];
      node.appendChild(h1);
      const ul = document.createElement('ul');
      node.appendChild(ul);
      for (let i = 0; i < specification['requirements'].length; i++) {
        const requirement = specification['requirements'][i];
        const li = document.createElement('li');
        ul.appendChild(li);
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = incr;
        li.appendChild(checkbox);
        const text = document.createTextNode(requirement['id'] + " - ");
        li.appendChild(text);
        const lines = requirement['text'].split('\n');

        // Iterate over the lines and create text nodes and <br> elements
        for (let j = 0; j < lines.length; j++) {
          // Create a text node for each line
          const lineNode = document.createTextNode(lines[j]);
          li.appendChild(lineNode);

          // If it's not the last line, create a <br> element
          if (j < lines.length - 1) {
            const br = document.createElement('br');
            li.appendChild(br);
          }
        }
        incr += 1;
      }
      if ('parts' in specification) {
        for (let i = 0; i < specification['parts'].length; i++) {
          const part = specification['parts'][i];
          const li = document.createElement('li');
          ul.appendChild(li);
          incr = insert_spec(li, part, incr);
        }
      }
      return incr;
    }



    function insertSpecification(specification) {
      const specificationElement = document.getElementById('specification');
      const form = document.createElement('form');
      specificationElement.appendChild(form);
      insert_spec(form, specification, 0);
      const button = document.createElement('button');
      button.setAttribute('type', 'button');
      button.setAttribute('onclick', 'submitForm()');
      button.textContent = 'Generate test cases';
      form.appendChild(button);
    }
    window.addEventListener('load', function () {
      const request = new XMLHttpRequest();
      request.open('GET', 'http://127.0.0.1:5000/spec');
      request.onreadystatechange = function () {
        if ((request.readyState === 4) && (request.status === 200)) {
          const responseText = request.responseText;
          const jsonResponse = JSON.parse(responseText);
          insertSpecification(jsonResponse);
        }
      };
      request.send();
    });
  </script>
</head>

<body>
  <div id="specification"></div>
</body>

</html>